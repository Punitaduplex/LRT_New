@{
    ViewBag.Title = "ItemMasterExcel";
    Layout = "~/_LayoutVendor.cshtml";
}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.25/cr-1.5.4/rr-1.2.8/datatables.min.css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
@*<script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.25/cr-1.5.4/rr-1.2.8/datatables.min.js"></script>*@
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.15.3/xlsx.full.min.js"></script>

@*------------------------------------------------------------------------------upload excel file-----------------------------------------*@
<style>
    .loader {
        display: none;
        top: 251px;
        position: absolute;
        margin-left: -193px;
        margin-bottom: 117px;
        z-index: 99999;
    }
</style>
<script type="text/javascript">
    $("body").on("click", "#uploadExcel", function () {
        //Reference the FileUpload element.
        Resettable();
        var fileUpload = $("#fileUpload")[0];
        // alert()
        //Validate whether File is valid Excel file.
        var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.xls|.xlsx)$/;
        if (regex.test(fileUpload.value.toLowerCase())) {
            if (typeof (FileReader) != "undefined") {
                var reader = new FileReader();

                //For Browsers other than IE.
                if (reader.readAsBinaryString) {
                    reader.onload = function (e) {
                        ProcessExcel(e.target.result);
                    };
                    reader.readAsBinaryString(fileUpload.files[0]);
                } else {
                    //For IE Browser.
                    reader.onload = function (e) {
                        var data = "";
                        var bytes = new Uint8Array(e.target.result);
                        for (var i = 0; i < bytes.byteLength; i++) {
                            data += String.fromCharCode(bytes[i]);
                        }
                        ProcessExcel(data);
                    };
                    reader.readAsArrayBuffer(fileUpload.files[0]);
                }
            } else {
                alert("This browser does not support HTML5.");
            }
        } else {
            alert("Please upload a valid Excel file.");
        }
    });
    function ProcessExcel(data) {
        $('#ExcelDataLoader').show();
        var workbook = XLSX.read(data, {
            type: 'binary'
        });
        var firstSheet = workbook.SheetNames[0];
        var excelRows = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[firstSheet]);
        // $("#dvExcel").empty();
        $("#dvExcel").append('<table id="EmpInfoitem" class="table table-bordered table-hover" style="width:100%"><thead><tr><th class="left_c w61_i">S. No</th> <th class="left_c">Item Type</th> <th class="left_c">Sub Item Type</th> <th class="left_c">MPN</th><th class="left_c">Description</th><th class="left_c">Quantity</th><th class="left_c">UOM</th><th class="left_c">Rack</th><th class="left_c">Bin No</th><th class="w155_i">Action</th> </tr></thead><tbody></tbody> </table>')
        $("#EmpInfoitem > tbody").html("");
        var count = excelRows.length;
        for (var i = 0; i < excelRows.length; i++) {
            var Item_Type_Name = "";
            var Sub_Item_Type_Name = "";
            var MPN = "";
            var Description = "";
            var Quntity = "";
            var uom = "";
            var Rack = "";
            var Binno = "";
            if (excelRows[i].ITEMTYPENAME == undefined) {
                Item_Type_Name = "";
            }
            else {
                Item_Type_Name = excelRows[i].ITEMTYPENAME;
            }

            if (excelRows[i].SUBITEMTYPENAME == undefined) {
                Sub_Item_Type_Name = "";
            }
            else {
                Sub_Item_Type_Name = excelRows[i].SUBITEMTYPENAME;
            }

            if (excelRows[i].MANUFACTURINGPARTNUMBER == undefined) {
                MPN = "";
            }
            else {
                MPN = excelRows[i].MANUFACTURINGPARTNUMBER;
            }
            alert(excelRows[i].ItemDescription)
            if (excelRows[i].ItemDescription == undefined) {
                Description = "";
            }
            else {
                Description = excelRows[i].ItemDescription;
            }

            if (excelRows[i].Quantity == undefined) {
                Quntity = "";
            }
            else {
                Quntity = excelRows[i].Quantity;
            }

            if (excelRows[i].UOM == undefined) {
                uom = "";
            }
            else {
                uom = excelRows[i].UOM;
            }

            if (excelRows[i].Rack == undefined) {
                Rack = "";
            }
            else {
                Rack = excelRows[i].Rack;
            }
            if (excelRows[i].RackNo == undefined) {
                Binno = "";
            }
            else {
                Binno = excelRows[i].RackNo;
            }
            tr = $('<tr/>');
            tr.append("<td class='left_c w61_i'>" + (i + 1) + "</td>");
            tr.append("<td class='left_c'>" + Item_Type_Name + "</td>");
            tr.append("<td class='left_c'>" + Sub_Item_Type_Name + "</td>");
            tr.append("<td class='left_c'>" + MPN + "</td>");
            tr.append("<td class='left_c'>" + Description + "</td>");
            tr.append("<td class='left_c'>" + Quntity + "</td>");
            tr.append("<td class='left_c'>" + uom + "</td>");
            tr.append("<td class='left_c'>" + Rack + "</td>");
            tr.append("<td class='left_c'>" + Binno + "</td>");
            tr.append("<td class='lst_td w155_i'><ul class='list_main'><li><a  href='javascript:void(0);' class='deletestore tooltip-error comn_inline red' data-rel='tooltip'><i class='menu-icon fa fa-trash bigger-120 red'></i></a></li></ul></td>");

            $('#EmpInfoitem').append(tr);
        }
        $('#EmpInfoitem').DataTable();
        $('#EmpInfoitem').dataTable({
            destroy: true,
            "infoCallback": function (settings, start, end, max, total, pre) {
                return "Showing 1 to " + count + " entries";
            }
        });
        sessionStorage.setItem("item-count26", count);
        $('#ExcelDataLoader').hide();
    };
</script>
<script>
    $(document).on("click", "a.deletestore", function () {

        var $row = $(this).closest("tr");    // Find the row
        var $id = $row.find('td:eq(0)').text();
        // $row.hide();
        //$row.remove();

        $row.remove().draw(false);
        //$(this).parents("tr").remove();
        var oTable = $('#EmpInfoitem').dataTable();

        var rowcollection = oTable.$("tr", { "page": "all" });

        var count = sessionStorage.getItem("item-count26");

        sessionStorage.setItem("item-count26", (count - 1));

        var count1 = count - 1;

        var table = $('#EmpInfoitem').DataTable({
            destroy: true,
            rowReorder: true
        });
        table.on('row-reorder', function (e, diff, edit) {
            var res = '';
            for (var i = 0, ien = diff.length ; i < ien ; i++) {
                res += diff[i].newData + '=';
            }
            res = res.substring(0, res.length - 1);
            getVal(res);
        });
        $('#EmpInfoitem').dataTable({
            destroy: true,
            "infoCallback": function (settings, start, end, max, total, pre) {
                return "Showing 1 to " + count1 + " entries";
            }
        });
        if (count <= 1) {
            Resettable();
        }
    });
</script>
<script type="text/javascript">
    $(function () {
        $("#btnsaveuploaddb").click(function () {
            $('#ExcelDataLoader').show();
            var objItem = {};
            objItem.UOM_Name = "";
            objItem.Item_Type_Name = "";
            objItem.Item_Sub_Type_Name = "";
            objItem.Item_Description = "";
            objItem.Item_Manufacturing_Part_Number = "";
            objItem.Item_Quntity_str = "";
            objItem.Rack_Name = "";
            objItem.Rack_Number_Name = "";
            var oTable = $('#EmpInfoitem').dataTable();
            var rowcollection = oTable.$("tr", { "page": "all" });

            rowcollection.each(function (index, elem) {
                var row = $(elem).closest("tr");

                if (objItem.Item_Manufacturing_Part_Number == "") {
                    objItem.Item_Type_Name = row.find('td:eq(1)').text().toUpperCase();
                    objItem.Item_Sub_Type_Name = row.find('td:eq(2)').text().toUpperCase();
                    objItem.Item_Manufacturing_Part_Number = row.find('td:eq(3)').text().toUpperCase();
                    objItem.Item_Description = row.find('td:eq(4)').text().toUpperCase();
                    objItem.Item_Quntity_str = row.find('td:eq(5)').text().toUpperCase();
                    objItem.UOM_Name = row.find('td:eq(6)').text().toUpperCase();
                    objItem.Rack_Name = row.find('td:eq(7)').text().toUpperCase();
                    objItem.Rack_Number_Name = row.find('td:eq(8)').text().toUpperCase();
                }
                else {
                    objItem.Item_Type_Name = objItem.Item_Type_Name + "," + row.find('td:eq(1)').text().toUpperCase();
                    objItem.Item_Sub_Type_Name = objItem.Item_Sub_Type_Name + "," + row.find('td:eq(2)').text().toUpperCase();
                    objItem.Item_Manufacturing_Part_Number = objItem.Item_Manufacturing_Part_Number + "," + row.find('td:eq(3)').text().toUpperCase();
                    objItem.Item_Description = objItem.Item_Description + "," + row.find('td:eq(4)').text().toUpperCase();
                    objItem.Item_Quntity_str = objItem.Item_Quntity_str + "," + row.find('td:eq(5)').text().toUpperCase();
                    objItem.UOM_Name = objItem.UOM_Name + "," + row.find('td:eq(6)').text().toUpperCase();
                    objItem.Rack_Name = objItem.Rack_Name + "," + row.find('td:eq(7)').text().toUpperCase();
                    objItem.Rack_Number_Name = objItem.Rack_Number_Name + "," + row.find('td:eq(8)').text().toUpperCase();
                }
            });
           
            var rowCount = $('#EmpInfoitem tr').length;
            if (rowCount <= 1) {
                swal("please upload excel file for data upload.");
                return;
            }
            if (rowCount > 1 && objItem.Store_Location_Name == "") {
                swal("no data in table.");
                return;
            }
            $.ajax({
                type: "POST",
                url: "/Master/AddItemByExcel",
                data: '{objItem: ' + JSON.stringify(objItem) + '}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    $(".dataTables_wrapper").remove();
                    swal(response);
                  //  Getdata();
                 //   Resettable();
                    $('#ExcelDataLoader').hide();
                    var script = document.createElement("script");
                    script.type = "text/javascript";
                    script.src = "/assets/js/jquery.dataTables.min.js";
                    document.getElementsByTagName("body")[0].appendChild(script);
                    $('#ExcelDataLoader').hide();
                },
                failure: function (response) {
                    alert(response.responseText);
                },
                error: function (response) {
                    alert(response.responseText);
                }
            });

        });
        $("#btnresetstorelocation").click(function () {
            Resettable();
        });
        $('#fileUpload').change(function (e) {

            var file = e.target.files[0].name;
            $(this).next('span').text(file);
        });
    });
</script>
<script>
    function Resettable() {
        $("#dvExcel").empty();
        $('#spnfile').text("");
        $('#spnfile').append('<span class="ace-file-name" id="spnfile1" data-title="No File ..."><i class=" ace-icon fa fa-upload"></i></span>')

    }
</script>
<script>
    function GetQRCode() {
        var num = Math.floor(Math.random() * 9000000000) + 1000000000;
        $("#barcode").val(num);
        var qrcode = {};
        qrcode.QRCodeText = num;
        $.ajax({
            type: "Post",
            url: "/Master/Generate",
            data: '{qrcode: ' + JSON.stringify(qrcode) + '}',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response) {
                document.getElementById('imgqrcode').src = response.QRCodeImagePath;
                $("#hdqrimagepath").val(response.QRCodeImagePath);
            },
            failure: function (response) {
                alert(response.responseText);
            },
            error: function (response) {
                alert(response.responseText);
            }
        });
    };
</script>
<script type="text/javascript">
    try { ace.settings.loadState('main-container') } catch (e) { }
</script>
<div id="sidebar" class="sidebar responsive ace-save-state top-padding">
    <script type="text/javascript">
        try { ace.settings.loadState('sidebar') } catch (e) { }
    </script>

    <div class="sidebar-shortcuts" id="sidebar-shortcuts">
        <div class="sidebar-shortcuts-large" id="sidebar-shortcuts-large">
            <button class="btn btn-success">
                <i class="ace-icon fa fa-signal"></i>
            </button>

            <button class="btn btn-info">
                <i class="ace-icon fa fa-pencil"></i>
            </button>

            <button class="btn btn-warning">
                <i class="ace-icon fa fa-users"></i>
            </button>

            <button class="btn btn-danger">
                <i class="ace-icon fa fa-cogs"></i>
            </button>
        </div>

        <div class="sidebar-shortcuts-mini" id="sidebar-shortcuts-mini">
            <span class="btn btn-success"></span>

            <span class="btn btn-info"></span>

            <span class="btn btn-warning"></span>

            <span class="btn btn-danger"></span>
        </div>
    </div><!-- /.sidebar-shortcuts -->
    @{ Html.RenderAction("SideMenu", "Master");}

    <div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
        <i id="sidebar-toggle-icon" class="ace-icon fa fa-angle-double-left ace-save-state" data-icon1="ace-icon fa fa-angle-double-left" data-icon2="ace-icon fa fa-angle-double-right"></i>
    </div>
</div>
<div class="main-content">
    <div class="main-content-inner top-padding">
        <div class="breadcrumbs ace-save-state" id="breadcrumbs" style=" z-index: -1 !IMPORTANT;">
            <ul class="breadcrumb">
                <li>
                    <i class="ace-icon fa fa-home home-icon"></i>
                    <a href="#">PMS Setting</a>
                </li>

                <li>
                    <a href="#">Item Master</a>
                </li>
                <li class="active">Item Master Excel</li>
            </ul><!-- /.breadcrumb -->
            @*<div class="nav-search" id="nav-search">
                <div class="form-search">
                    <span class="input-icon">
                        <input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
                        <i class="ace-icon fa fa-search nav-search-icon"></i>
                    </span>
                </div>
            </div>*@<!-- /.nav-search -->
        </div>
        <div class="page-content1">

            @*---------------------------------------------------------------------------------------------------------------------*@
            <div class="page-header">
                <h3 class="item_hedin">
                    Item Master Excel
                </h3>
            </div><!-- /.page-header -->

            <div class="row">
                <div class="col-xs-12">
                    <input type="hidden" id="hdstore" />
                    <div class="clearfix form-actions">
                        <div class="col-md-offset-0 col-md-12">
                            <a href="~/excelFile/ItemMasterExcelFile.xlsx">Download Template</a>
                            &nbsp; &nbsp; &nbsp;
                            @*<button class="btn btn-info" id="btnexcel" type="button" data-toggle="tooltip" style="width: auto;" title="Button for excel data">
                                    <i class="ace-icon fa fa-floppy-o"></i>
                                    Upload Excel File
                                </button>*@

                        </div>
                    </div>
                </div><!-- /.col -->
            </div>
            <div class="row">

                <div class="col-md-3">Choose excel file <span style="color:red;font-size:14px;">*</span><span>:</span></div>
                <div class="col-sm-9">
                    <div class="col-xs-8 pr-0">

                        <label class="ace-file-input upload_fl1"><input type="file" id="fileUpload" accept=".xls,.xlsx"><span class="ace-file-container upload_fl" id="spnfile" data-title="Choose"><span class="ace-file-name" id="spnfile1" data-title="No File ..."><i class=" ace-icon fa fa-upload"></i></span></span><a class="remove" href="#"><i class=" ace-icon fa fa-times"></i></a></label>
                    </div>
                    <div class="col-xs-4">
                        <i class="ace-icon fa fa-cloud-upload upload-ic"></i>
                        <input type="button" id="uploadExcel" class="btn btn-info upload-bt" value="Upload" onclick="ExportToTable()" />
                        <div id="ExcelDataLoader" class="loader">
                            <img src="~/Images/1.gif" height="70" width="60" />
                        </div>

                    </div>


                </div>
                <div class="space-6"></div>
                <div class="row" style="padding-top:45px">
                    <div class="col-xs-12">
                        <div class="form-horizontal">
                            <div id="dvExcel"></div>

                        </div>

                    </div><!-- /.span -->
                </div><!-- /.row -->
            </div>
            <div class="space-4"></div>
            <div class="row">
                <div class="col-md-3"></div>
                <div class="col-md-9">
                    <button class="btn btn-info" id="btnsaveuploaddb" type="button" data-toggle="tooltip" title="Button for save data">
                        <i class="ace-icon fa fa-floppy-o"></i>
                        Submit
                    </button>
                    <button class="btn master-page-reset" id="btnresetstorelocation" type="reset" data-toggle="tooltip" title="Button for reset data">
                        <i class="ace-icon fa fa-undo bigger-110"></i>
                        Reset
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
            @*<script src="https://code.jquery.com/jquery-3.5.1.js"></script>*@
            <script src="https://cdn.datatables.net/v/dt/dt-1.10.25/cr-1.5.4/rr-1.2.8/datatables.min.js"></script>
            @*<script src="https://cdn.datatables.net/v/dt/dt-1.10.25/cr-1.5.4/rr-1.2.8/datatables.min.js"></script>*@
            <link href="~/assets/css/colReorder.dataTables.css" rel="stylesheet" />
            <link href="~/assets/css/responsive.dataTables.css" rel="stylesheet" />
            <script src="~/assets/js/dataTables.colReorder.js"></script>
            <script src="~/assets/js/dataTables.responsive.js"></script>

            <link href="~/assets/css/rowReorder.dataTables.min.css" rel="stylesheet" />


            <script>

                    $(document).ready(function () {
                        // GetData1();
                        //$('#pending_from').dataTable({
                        //    colReorder: {
                        //        order: [4, 3, 2, 1, 0, ]
                        //    }
                        //});
                        $('#EmpInfoitem').dataTable({
                            colReorder: {
                                order: [0, 1, 2, 3, 4]
                            }
                        });
                    });



                </script>
